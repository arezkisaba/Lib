<?xml version="1.0" encoding="UTF-8"?>

<?ifndef ProductManufacturer ?>
<?define ProductManufacturer = "Arezki Saba"?>
<?endif ?>

<?ifndef ProductName ?>
<?define ProductName = "CHANGEME"?>
<?endif ?>

<?ifndef Version ?>
<?define Version = "1.0.0.0"?>
<?endif ?>

<?ifndef UpgradeCode ?>
<?define UpgradeCode = "00000001-0001-0001-0001-000000000001"?>
<?endif ?>

<?ifndef HandleStartup ?>
<?define HandleStartup = "False"?>
<?endif ?>

<?ifndef InstallFolder ?>
<?define InstallFolder = "C:\Program Files (x86)\$(var.ProductManufacturer)"?>
<?endif ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="$(var.ProductName)" Language="1033" Version="$(var.ProductVersion)" Manufacturer="$(var.ProductManufacturer)" UpgradeCode="$(var.UpgradeCode)">
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" Manufacturer="$(var.ProductManufacturer)" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />
    
    <!--<MajorUpgrade Schedule="afterInstallInitialize" AllowDowngrades="no" DowngradeErrorMessage="ok" AllowSameVersionUpgrades="yes" />-->
    <!--<Media Id="1" Cabinet="$(var.ProductName).cab" EmbedCab="yes" />-->
    <!--<Icon Id="Logo.ico" SourceFile="$(var.SampleApplication.TargetDir)\logo.ico" />-->
    <!--<Property Id="ARPPRODUCTICON" Value="Logo.ico" />-->
    <!--<Icon Id="Logo.ico" SourceFile="$(var.SampleApplication.TargetDir)\logo.ico" />-->
    
    <Icon Id="Logo.ico" SourceFile="$(var.ProjectDir)\logo.ico" />
    <Property Id="ARPPRODUCTICON" Value="Logo.ico" />

    <CustomAction Id="Install"
                  Property="InstallProperty"
                  Value="&quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&quot; -NoLogo -NonInteractive -InputFormat None -NoProfile -File &quot;$(var.InstallFolder)\$(var.ProductName)\install.ps1&quot; -InstallFolder &quot;$(var.InstallFolder)\$(var.ProductName)&quot; -ProductName &quot;$(var.ProductName)&quot; -HandleStartup &quot;$(var.HandleStartup)&quot;"
                  Execute="immediate" />
    <CustomAction Id="InstallProperty"
									BinaryKey="WixCA"
									DllEntry="CAQuietExec64"
									Execute="deferred"
									Return="check"
									Impersonate="no" />
    <CustomAction Id="Uninstall"
                  Property="UninstallProperty"
                  Value="&quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&quot; -NoLogo -NonInteractive -InputFormat None -NoProfile -File &quot;$(var.InstallFolder)\$(var.ProductName)\uninstall.ps1&quot; -ProductName &quot;$(var.ProductName)&quot; -HandleStartup &quot;$(var.HandleStartup)&quot;"
                  Execute="immediate" />
    <CustomAction Id="UninstallProperty"
									BinaryKey="WixCA"
									DllEntry="CAQuietExec64"
									Execute="deferred"
									Return="check"
									Impersonate="no" />
    <InstallExecuteSequence>
      <Custom Action="Install" After="CostFinalize">NOT Installed</Custom>
      <Custom Action="InstallProperty" After="InstallFiles">NOT Installed</Custom>
      <Custom Action="Uninstall" Before="CostFinalize">Installed</Custom>
      <Custom Action="UninstallProperty" Before="RemoveFiles">Installed</Custom>
    </InstallExecuteSequence>

    <Feature Id="ProductFeature" Title="$(var.ProductName)" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentGroupRef Id="ComponentGroupDesktopShortcut" />
    </Feature>
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="ROOTDIRECTORY" Name="$(var.ProductManufacturer)">
          <Directory Id="INSTALLFOLDER" Name="$(var.ProductName)">
            <Directory Id="DesktopFolder" Name="DesktopFolder" />
          </Directory>
        </Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="$(var.ProductName)"/>
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">

      			<Component Id="Artifacts_BabylonTools.XMap.deps.json" Guid="*">
				<File Id="Artifacts_BabylonTools.XMap.deps.json" Name="BabylonTools.XMap.deps.json" Source="$(var.ProjectDir)Artifacts\BabylonTools.XMap.deps.json"/>
			</Component>

			<Component Id="Artifacts_BabylonTools.XMap.dll" Guid="*">
				<File Id="Artifacts_BabylonTools.XMap.dll" Name="BabylonTools.XMap.dll" Source="$(var.ProjectDir)Artifacts\BabylonTools.XMap.dll"/>
			</Component>

			<Component Id="Artifacts_BabylonTools.XMap.dll.config" Guid="*">
				<File Id="Artifacts_BabylonTools.XMap.dll.config" Name="BabylonTools.XMap.dll.config" Source="$(var.ProjectDir)Artifacts\BabylonTools.XMap.dll.config"/>
			</Component>

			<Component Id="Artifacts_BabylonTools.XMap.exe" Guid="*">
				<File Id="Artifacts_BabylonTools.XMap.exe" Name="BabylonTools.XMap.exe" Source="$(var.ProjectDir)Artifacts\BabylonTools.XMap.exe"/>
			</Component>

			<Component Id="Artifacts_BabylonTools.XMap.pdb" Guid="*">
				<File Id="Artifacts_BabylonTools.XMap.pdb" Name="BabylonTools.XMap.pdb" Source="$(var.ProjectDir)Artifacts\BabylonTools.XMap.pdb"/>
			</Component>

			<Component Id="Artifacts_BabylonTools.XMap.runtimeconfig.dev.json" Guid="*">
				<File Id="Artifacts_BabylonTools.XMap.runtimeconfig.dev.json" Name="BabylonTools.XMap.runtimeconfig.dev.json" Source="$(var.ProjectDir)Artifacts\BabylonTools.XMap.runtimeconfig.dev.json"/>
			</Component>

			<Component Id="Artifacts_BabylonTools.XMap.runtimeconfig.json" Guid="*">
				<File Id="Artifacts_BabylonTools.XMap.runtimeconfig.json" Name="BabylonTools.XMap.runtimeconfig.json" Source="$(var.ProjectDir)Artifacts\BabylonTools.XMap.runtimeconfig.json"/>
			</Component>

			<Component Id="Artifacts_DROP_PACKAGE_HERE.txt" Guid="*">
				<File Id="Artifacts_DROP_PACKAGE_HERE.txt" Name="DROP_PACKAGE_HERE.txt" Source="$(var.ProjectDir)Artifacts\DROP_PACKAGE_HERE.txt"/>
			</Component>

			<Component Id="Artifacts_install.ps1" Guid="*">
				<File Id="Artifacts_install.ps1" Name="install.ps1" Source="$(var.ProjectDir)Artifacts\install.ps1"/>
			</Component>

			<Component Id="Artifacts_Lib.Core.dll" Guid="*">
				<File Id="Artifacts_Lib.Core.dll" Name="Lib.Core.dll" Source="$(var.ProjectDir)Artifacts\Lib.Core.dll"/>
			</Component>

			<Component Id="Artifacts_Lib.Win32.dll" Guid="*">
				<File Id="Artifacts_Lib.Win32.dll" Name="Lib.Win32.dll" Source="$(var.ProjectDir)Artifacts\Lib.Win32.dll"/>
			</Component>

			<Component Id="Artifacts_Microsoft.Win32.SystemEvents.dll" Guid="*">
				<File Id="Artifacts_Microsoft.Win32.SystemEvents.dll" Name="Microsoft.Win32.SystemEvents.dll" Source="$(var.ProjectDir)Artifacts\Microsoft.Win32.SystemEvents.dll"/>
			</Component>

			<Component Id="Artifacts_NAudio.dll" Guid="*">
				<File Id="Artifacts_NAudio.dll" Name="NAudio.dll" Source="$(var.ProjectDir)Artifacts\NAudio.dll"/>
			</Component>

			<Component Id="Artifacts_Newtonsoft.Json.dll" Guid="*">
				<File Id="Artifacts_Newtonsoft.Json.dll" Name="Newtonsoft.Json.dll" Source="$(var.ProjectDir)Artifacts\Newtonsoft.Json.dll"/>
			</Component>

			<Component Id="Artifacts_README.txt" Guid="*">
				<File Id="Artifacts_README.txt" Name="README.txt" Source="$(var.ProjectDir)Artifacts\README.txt"/>
			</Component>

			<Component Id="Artifacts_SharpDX.dll" Guid="*">
				<File Id="Artifacts_SharpDX.dll" Name="SharpDX.dll" Source="$(var.ProjectDir)Artifacts\SharpDX.dll"/>
			</Component>

			<Component Id="Artifacts_SharpDX.XInput.dll" Guid="*">
				<File Id="Artifacts_SharpDX.XInput.dll" Name="SharpDX.XInput.dll" Source="$(var.ProjectDir)Artifacts\SharpDX.XInput.dll"/>
			</Component>

			<Component Id="Artifacts_System.Configuration.ConfigurationManager.dll" Guid="*">
				<File Id="Artifacts_System.Configuration.ConfigurationManager.dll" Name="System.Configuration.ConfigurationManager.dll" Source="$(var.ProjectDir)Artifacts\System.Configuration.ConfigurationManager.dll"/>
			</Component>

			<Component Id="Artifacts_System.Diagnostics.EventLog.dll" Guid="*">
				<File Id="Artifacts_System.Diagnostics.EventLog.dll" Name="System.Diagnostics.EventLog.dll" Source="$(var.ProjectDir)Artifacts\System.Diagnostics.EventLog.dll"/>
			</Component>

			<Component Id="Artifacts_System.Drawing.Common.dll" Guid="*">
				<File Id="Artifacts_System.Drawing.Common.dll" Name="System.Drawing.Common.dll" Source="$(var.ProjectDir)Artifacts\System.Drawing.Common.dll"/>
			</Component>

			<Component Id="Artifacts_System.Resources.Extensions.dll" Guid="*">
				<File Id="Artifacts_System.Resources.Extensions.dll" Name="System.Resources.Extensions.dll" Source="$(var.ProjectDir)Artifacts\System.Resources.Extensions.dll"/>
			</Component>

			<Component Id="Artifacts_System.Security.Cryptography.ProtectedData.dll" Guid="*">
				<File Id="Artifacts_System.Security.Cryptography.ProtectedData.dll" Name="System.Security.Cryptography.ProtectedData.dll" Source="$(var.ProjectDir)Artifacts\System.Security.Cryptography.ProtectedData.dll"/>
			</Component>

			<Component Id="Artifacts_System.Security.Permissions.dll" Guid="*">
				<File Id="Artifacts_System.Security.Permissions.dll" Name="System.Security.Permissions.dll" Source="$(var.ProjectDir)Artifacts\System.Security.Permissions.dll"/>
			</Component>

			<Component Id="Artifacts_System.ServiceProcess.ServiceController.dll" Guid="*">
				<File Id="Artifacts_System.ServiceProcess.ServiceController.dll" Name="System.ServiceProcess.ServiceController.dll" Source="$(var.ProjectDir)Artifacts\System.ServiceProcess.ServiceController.dll"/>
			</Component>

			<Component Id="Artifacts_System.Windows.Extensions.dll" Guid="*">
				<File Id="Artifacts_System.Windows.Extensions.dll" Name="System.Windows.Extensions.dll" Source="$(var.ProjectDir)Artifacts\System.Windows.Extensions.dll"/>
			</Component>

			<Component Id="Artifacts_uninstall.ps1" Guid="*">
				<File Id="Artifacts_uninstall.ps1" Name="uninstall.ps1" Source="$(var.ProjectDir)Artifacts\uninstall.ps1"/>
			</Component>


    </ComponentGroup>
  </Fragment>

  <!--Start menu shortcut-->
  <Fragment>
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="*">
        <Shortcut Id="ApplicationStartMenuShortcut" Name="$(var.ProductName)" Description="$(var.ProductName)" Icon="Logo.ico" Target="[#Artifacts_$(var.ProductName).exe]" WorkingDirectory="INSTALLFOLDER" />
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\Microsoft\$(var.ProductManufacturer)\$(var.ProductName)" Name="installed" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </DirectoryRef>
  </Fragment>

  <!--Desktop shortcut-->
  <Fragment>
    <ComponentGroup Id="ComponentGroupDesktopShortcut">
      <Component Id="ComponentDesktopShortcut" Guid="*" Directory="DesktopFolder" >
        <Shortcut Id="AppDesktopShortcut" Name="$(var.ProductName)" Description="$(var.ProductName)" Icon="Logo.ico" Target="[#Artifacts_$(var.ProductName).exe]" WorkingDirectory="INSTALLFOLDER" Directory="DesktopFolder" />
        <RemoveFolder Id="DesktopFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\$(var.ProductManufacturer)\$(var.ProductName)" Name="installed" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>

</Wix>
